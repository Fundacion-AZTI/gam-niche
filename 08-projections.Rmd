---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Prediction and maps

predict from fitted models and produce maps

Loading required libraries

```{r, eval=F}

library(rgdal)
library(ggplot2)
library(dplyr)
library(fields) #imageplot
library(maps) #map world
library(raster)
library(RColorBrewer)#color palette
library(tidyverse)
library(rstudioapi)

# general settings for ggplot (black-white background, larger base_size)
theme_set(theme_bw(base_size = 16))
```

## Projection

```{r, eval=F}

# location of script
setwd(dirname(getSourceEditorContext()$path))

#load PA data
load(file.path ("data", "outputs_for_modelling", "PAdata_with_env.Rdata"))

#Load raster stack containing all variables

load("data/env/env_dataframe.Rdata")

#remove positive bathy
env_dataframe_proj<-subset(env_dataframe,BO_bathymean<0)

#Load SC-GAM model

load(file.path("models", "model.Rdata"))

# predicting 
predict <- predict(selected_model,newdata=env_dataframe_proj,type ="response",se.fit=T)         
env_dataframe_proj$fit<-predict$fit
env_dataframe_proj$se.fit<-predict$se.fit


```


## Mapping

```{r, eval=F}
p<-ggplot()+geom_raster(data=subset(env_dataframe_proj),aes(x,y,fill=fit))+scale_fill_gradient2(low="blue", mid="orange",high="red",midpoint = 0.5) +ggtitle("with bathy concave")+ geom_point(data=subset(data,occurrenceStatus==1),aes(LON,LAT),col=1,size=0.3)     

print(p)

ggsave(file.path("plots","projections",paste0("proj_map.png")), p, device="png")

save(env_dataframe_proj, file="results/projection.Rdata")

```

