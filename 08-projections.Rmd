---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Prediction and maps

predict from fitted models and produce maps

### Loading required libraries

```{r, eval=F}

library(rgdal)
library(ggplot2)
library(dplyr)
library(fields) #imageplot
library(maps) #map world
library(raster)
library(RColorBrewer)#color palette
library(tidyverse)
```

# Projection

```{r, eval=F}

#Load raster stack containing all variables

load(here::here ("data","env", "myBioracle.layers.Rdata"))

#load area plygon
load("C:/use/GitHub/SDM/data/spatial/total_area.RData")

# Transform raster stack to table

env_dataframe <- as.data.frame(myBioracle.layers, xy=TRUE)
ptos<-env_dataframe[,c("x","y")]

coordinates(ptos) <- ~ x + y
proj4string(ptos) <-proj4string(FAO_Atl_no_black_sea)
  
## Select only occurrences from FAO Atlantic
env_dataframe<-data.frame(subset(env_dataframe,!is.na(over(ptos, FAO_Atl_no_black_sea)[,1])))

save(env_dataframe,file="data/env/env_dataframe.Rdata")

#Load SC-GAM model

load(here::here ("models", "model.Rdata"))

# predicting 

predict <- predict(selected_model,newdata=v_table,type ="response",se.fit=T)            

env_dataframe$fit<-predict$fit
env_dataframe$se.fit<-predict$se.fit

summary(env_dataframe)

probabilities_predict.r <- env_dataframe %>%
    dplyr::select (x, y, fit) %>%
   rasterFromXYZ()
```


# Mapping

```{r, eval=F}
plot(probabilities_predict.r)
```

