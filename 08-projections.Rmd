---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Prediction and maps

predict from fitted models and produce maps

### Loading required libraries

```{r, eval=F}

library(rgdal)
library(ggplot2)
library(dplyr)
library(fields) #imageplot
library(maps) #map world
library(raster)
library(RColorBrewer)#color palette
library(tidyverse)
```

# Projection

```{r, eval=F}

#Load raster stack containing all variables

depth_set_0 <- myBioracle.layers
ea<-intersect(myBioracle.layers,FAO_Atl_no_black_sea)

# Transform raster stack to table

v_table <- as.data.frame(depth_set_0, xy=TRUE)

#Load SC-GAM model

load(here::here ("models", "selected_model.Rdata"))

# predicting 

predict <- predict(selected_model,newdata=v_table,type ="response",se.fit=T)            

probabilities_predict<-cbind(v_table,predict)

summary(probabilities_predict)

area<-st_union(st_as_sf(FAO_Atl_no_black_sea))
pred_sf<-st_as_sf(probabilities_predict,coords=c("x","y"))
pred_sf<-st_set_crs(pred_sf,crs(area))

pred_atl<-st_intersection(pred_sf,area)

 probabilities_predict.r <- probabilities_predict %>%
    dplyr::select (x, y, fit) %>%
   rasterFromXYZ()

```


# Mapping

```{r, eval=F}
plot(pred_atl[,"fit"])
ggplot()+geom_sf(data=pred_atl,aes(col="fit"))
plot(probabilities_predict.r)
```

