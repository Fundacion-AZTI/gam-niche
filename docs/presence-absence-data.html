<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Presence-absence data | Species distribution models (SDM)</title>
  <meta name="description" content="This is a short tutorial about constructing species distribution models in R using shape-constrained generalized additive models." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Presence-absence data | Species distribution models (SDM)" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a short tutorial about constructing species distribution models in R using shape-constrained generalized additive models." />
  <meta name="github-repo" content="Fundacion-AZTI/SDM" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Presence-absence data | Species distribution models (SDM)" />
  
  <meta name="twitter:description" content="This is a short tutorial about constructing species distribution models in R using shape-constrained generalized additive models." />
  

<meta name="author" content="AZTI" />


<meta name="date" content="2023-04-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="environmental-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><img src="images/AZTI.png" width="200"></a></li>
<li><a href="./">SDM</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="presence-absence-data.html"><a href="presence-absence-data.html"><i class="fa fa-check"></i><b>2</b> Presence-absence data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="presence-absence-data.html"><a href="presence-absence-data.html#download-presence-data"><i class="fa fa-check"></i><b>2.1</b> Download presence data</a></li>
<li class="chapter" data-level="2.2" data-path="presence-absence-data.html"><a href="presence-absence-data.html#create-pseudo-absence-data"><i class="fa fa-check"></i><b>2.2</b> Create pseudo-absence data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="environmental-data.html"><a href="environmental-data.html"><i class="fa fa-check"></i><b>3</b> Environmental data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="environmental-data.html"><a href="environmental-data.html#download-from-public-repositories"><i class="fa fa-check"></i><b>3.1</b> Download from public repositories</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="prepare-final-dataset.html"><a href="prepare-final-dataset.html"><i class="fa fa-check"></i><b>4</b> Prepare final dataset</a>
<ul>
<li class="chapter" data-level="4.1" data-path="prepare-final-dataset.html"><a href="prepare-final-dataset.html#extract-environmental-data-associated-to-presence-absence-data"><i class="fa fa-check"></i><b>4.1</b> Extract environmental data associated to presence-absence data</a></li>
<li class="chapter" data-level="4.2" data-path="prepare-final-dataset.html"><a href="prepare-final-dataset.html#exploratory-plots-of-environmental-variables"><i class="fa fa-check"></i><b>4.2</b> Exploratory plots of environmental variables</a></li>
<li class="chapter" data-level="4.3" data-path="prepare-final-dataset.html"><a href="prepare-final-dataset.html#exploratory-plots-of-environmental-variables-depending-on-presenceabsence-data"><i class="fa fa-check"></i><b>4.3</b> Exploratory plots of environmental variables depending on presence/absence data</a></li>
<li class="chapter" data-level="4.4" data-path="prepare-final-dataset.html"><a href="prepare-final-dataset.html#correlation-analysis"><i class="fa fa-check"></i><b>4.4</b> Correlation analysis</a></li>
<li class="chapter" data-level="4.5" data-path="prepare-final-dataset.html"><a href="prepare-final-dataset.html#variance-inflation-factor-vif"><i class="fa fa-check"></i><b>4.5</b> Variance Inflation Factor (VIF)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="shape-constrained-generalized-additive-models.html"><a href="shape-constrained-generalized-additive-models.html"><i class="fa fa-check"></i><b>5</b> Shape Constrained-Generalized Additive Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="shape-constrained-generalized-additive-models.html"><a href="shape-constrained-generalized-additive-models.html#model-fit"><i class="fa fa-check"></i><b>5.1</b> Model fit</a></li>
<li class="chapter" data-level="5.2" data-path="shape-constrained-generalized-additive-models.html"><a href="shape-constrained-generalized-additive-models.html#model-selection"><i class="fa fa-check"></i><b>5.2</b> Model selection</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-validation.html"><a href="model-validation.html"><i class="fa fa-check"></i><b>6</b> Model validation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-validation.html"><a href="model-validation.html#optimum-threshold"><i class="fa fa-check"></i><b>6.1</b> Optimum threshold</a></li>
<li class="chapter" data-level="6.2" data-path="model-validation.html"><a href="model-validation.html#k-fold-validation"><i class="fa fa-check"></i><b>6.2</b> k-fold validation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="prediction-and-maps.html"><a href="prediction-and-maps.html"><i class="fa fa-check"></i><b>7</b> Prediction and maps</a>
<ul>
<li class="chapter" data-level="7.1" data-path="prediction-and-maps.html"><a href="prediction-and-maps.html#prepare-environmental-data.-04-ataletik-hona-mugituta"><i class="fa fa-check"></i><b>7.1</b> Prepare environmental data. 04 ATALETIK HONA MUGITUTA</a></li>
<li class="chapter" data-level="7.2" data-path="prediction-and-maps.html"><a href="prediction-and-maps.html#projection"><i class="fa fa-check"></i><b>7.2</b> Projection</a></li>
<li class="chapter" data-level="7.3" data-path="prediction-and-maps.html"><a href="prediction-and-maps.html#mapping"><i class="fa fa-check"></i><b>7.3</b> Mapping</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="8" data-path="libraries.html"><a href="libraries.html"><i class="fa fa-check"></i><b>8</b> Libraries</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Species distribution models (SDM)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="presence-absence-data" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Presence-absence data<a href="presence-absence-data.html#presence-absence-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter we first, download occurrence data from global open-access datasets such as Global Biodiversity Information Facility (GBIF, <a href="https://www.gbif.org/" class="uri">https://www.gbif.org/</a>) and Ocean Biodiversity Information System (OBIS, <a href="https://obis.org/" class="uri">https://obis.org/</a>); second, clean downloaded data reformating, renaming fields and removing outliers data; and lastly, we generate a set of pseudoabsence points along our study area.</p>
<p>First we load list required libraries.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="presence-absence-data.html#cb1-1" aria-hidden="true" tabindex="-1"></a>requiredPackages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="presence-absence-data.html#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#GENERAL USE LIBRARIES --------#</span></span>
<span id="cb1-3"><a href="presence-absence-data.html#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;here&quot;</span>, <span class="co"># Library for reproducible workflow</span></span>
<span id="cb1-4"><a href="presence-absence-data.html#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rstudioapi&quot;</span>,  <span class="co"># Library for reproducible workflow</span></span>
<span id="cb1-5"><a href="presence-absence-data.html#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;maptools&quot;</span>, <span class="co">#plotting world map</span></span>
<span id="cb1-6"><a href="presence-absence-data.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;ggplot2&quot;</span>, <span class="co">#for plotting</span></span>
<span id="cb1-7"><a href="presence-absence-data.html#cb1-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-8"><a href="presence-absence-data.html#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Presence-absence data chapter--------#</span></span>
<span id="cb1-9"><a href="presence-absence-data.html#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;robis&quot;</span>, <span class="co"># Specific library to get the occurrence data</span></span>
<span id="cb1-10"><a href="presence-absence-data.html#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rgbif&quot;</span>,<span class="co"># Specific library to get the occurrence data</span></span>
<span id="cb1-11"><a href="presence-absence-data.html#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;CoordinateCleaner&quot;</span>, <span class="co">#to remove outlier</span></span>
<span id="cb1-12"><a href="presence-absence-data.html#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rgdal&quot;</span>, <span class="co"># to work with Spatial data</span></span>
<span id="cb1-13"><a href="presence-absence-data.html#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;sf&quot;</span>, <span class="co"># to work with spatial data (shapefiles)</span></span>
<span id="cb1-14"><a href="presence-absence-data.html#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data.table&quot;</span>, <span class="co">#for reading data,</span></span>
<span id="cb1-15"><a href="presence-absence-data.html#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;dplyr&quot;</span>, <span class="co">#for reading data,</span></span>
<span id="cb1-16"><a href="presence-absence-data.html#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tidyr&quot;</span> <span class="co">#for reading data</span></span>
<span id="cb1-17"><a href="presence-absence-data.html#cb1-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Function to install the required packages that are not in your system and load all the required packages</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="presence-absence-data.html#cb2-1" aria-hidden="true" tabindex="-1"></a>install_load_function <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb2-2"><a href="presence-absence-data.html#cb2-2" aria-hidden="true" tabindex="-1"></a>  new.pkg <span class="ot">&lt;-</span> pkg[<span class="sc">!</span>(pkg <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[, <span class="st">&quot;Package&quot;</span>])]</span>
<span id="cb2-3"><a href="presence-absence-data.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(new.pkg))</span>
<span id="cb2-4"><a href="presence-absence-data.html#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(new.pkg, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-5"><a href="presence-absence-data.html#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(pkg, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-6"><a href="presence-absence-data.html#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-7"><a href="presence-absence-data.html#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="presence-absence-data.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install_load_function</span>(requiredPackages)</span></code></pre></div>
<p>Define some settings</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="presence-absence-data.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># location of script</span></span>
<span id="cb3-2"><a href="presence-absence-data.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="fu">dirname</span>(<span class="fu">getSourceEditorContext</span>()<span class="sc">$</span>path))</span>
<span id="cb3-3"><a href="presence-absence-data.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="presence-absence-data.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># general settings for ggplot (black-white background, larger base_size)</span></span>
<span id="cb3-5"><a href="presence-absence-data.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>))</span></code></pre></div>
<div id="download-presence-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Download presence data<a href="presence-absence-data.html#download-presence-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First we need to define our study area, in this case we select the Atlantic ocean based on the The Food and Agriculture Organization (FAO) Major Fishing Areas for Statistical Purposes and we remove Black sea subarea.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="presence-absence-data.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># url where FAO shapfile is stored</span></span>
<span id="cb4-2"><a href="presence-absence-data.html#cb4-2" aria-hidden="true" tabindex="-1"></a>url<span class="ot">&lt;-</span><span class="st">&quot;https://www.fao.org/fishery/geoserver/area/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=area%3AFAO_AREAS&amp;maxFeatures=50&amp;outputFormat=SHAPE-ZIP&quot;</span></span>
<span id="cb4-3"><a href="presence-absence-data.html#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="presence-absence-data.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#download file</span></span>
<span id="cb4-5"><a href="presence-absence-data.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(url,<span class="st">&quot;data/spatial/FAO_AREAS.zip&quot;</span>,<span class="at">mode=</span><span class="st">&quot;wb&quot;</span>)</span>
<span id="cb4-6"><a href="presence-absence-data.html#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="presence-absence-data.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#unzip downloaded file</span></span>
<span id="cb4-8"><a href="presence-absence-data.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;data/spatial/FAO_AREAS.zip&quot;</span>,<span class="at">exdir=</span><span class="st">&quot;data/spatial&quot;</span>)</span>
<span id="cb4-9"><a href="presence-absence-data.html#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="presence-absence-data.html#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Load FAO (spatial multipolygon)</span></span>
<span id="cb4-11"><a href="presence-absence-data.html#cb4-11" aria-hidden="true" tabindex="-1"></a>FAO<span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">file.path</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;spatial&quot;</span>, <span class="st">&quot;FAO_AREAS.shp&quot;</span>))</span>
<span id="cb4-12"><a href="presence-absence-data.html#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="presence-absence-data.html#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Select Atlantic Ocean FAO Area </span></span>
<span id="cb4-14"><a href="presence-absence-data.html#cb4-14" aria-hidden="true" tabindex="-1"></a>FAO_Atl <span class="ot">&lt;-</span> FAO[FAO<span class="sc">$</span>OCEAN<span class="sc">==</span><span class="st">&quot;Atlantic&quot;</span>,]</span>
<span id="cb4-15"><a href="presence-absence-data.html#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="presence-absence-data.html#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Select Black sea subarea </span></span>
<span id="cb4-17"><a href="presence-absence-data.html#cb4-17" aria-hidden="true" tabindex="-1"></a>Black_Sea <span class="ot">&lt;-</span> FAO_Atl[FAO_Atl<span class="sc">$</span>ID<span class="sc">==</span><span class="st">&quot;20&quot;</span>,]</span>
<span id="cb4-18"><a href="presence-absence-data.html#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="presence-absence-data.html#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to sf objects</span></span>
<span id="cb4-20"><a href="presence-absence-data.html#cb4-20" aria-hidden="true" tabindex="-1"></a>FAO_Atl.sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(FAO_Atl)</span>
<span id="cb4-21"><a href="presence-absence-data.html#cb4-21" aria-hidden="true" tabindex="-1"></a>Black_Sea.sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(Black_Sea)</span>
<span id="cb4-22"><a href="presence-absence-data.html#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="presence-absence-data.html#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Black sea using st_difference (reverse of st_intersection)</span></span>
<span id="cb4-24"><a href="presence-absence-data.html#cb4-24" aria-hidden="true" tabindex="-1"></a>FAO_Atl_no_black_sea <span class="ot">&lt;-</span> <span class="fu">st_difference</span>(FAO_Atl.sf,Black_Sea.sf) <span class="sc">%&gt;%</span>   dplyr<span class="sc">::</span><span class="fu">select</span> (F_AREA)</span>
<span id="cb4-25"><a href="presence-absence-data.html#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="presence-absence-data.html#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">#transform to spatial polygons dataframe</span></span>
<span id="cb4-27"><a href="presence-absence-data.html#cb4-27" aria-hidden="true" tabindex="-1"></a>study_area<span class="ot">&lt;-</span> sf<span class="sc">:::</span><span class="fu">as_Spatial</span>(FAO_Atl_no_black_sea)</span>
<span id="cb4-28"><a href="presence-absence-data.html#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="presence-absence-data.html#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(study_area)</span></code></pre></div>
<p>Download data from OBIS and GBIF using scientific name. In this case we select Albacore tuna species (<em>Thunnus alalunga</em>).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="presence-absence-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data from OBIS</span></span>
<span id="cb5-2"><a href="presence-absence-data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>mydata.obis<span class="ot">&lt;-</span>robis<span class="sc">::</span><span class="fu">occurrence</span>(<span class="at">scientificname=</span><span class="st">&quot;Thunnus alalunga&quot;</span>)</span>
<span id="cb5-3"><a href="presence-absence-data.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="presence-absence-data.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data from GBIF</span></span>
<span id="cb5-5"><a href="presence-absence-data.html#cb5-5" aria-hidden="true" tabindex="-1"></a>mydata.gbif<span class="ot">&lt;-</span><span class="fu">occ_data</span>(<span class="at">scientificName=</span><span class="st">&quot;Thunnus alalunga&quot;</span>, <span class="at">hasCoordinate =</span> <span class="cn">TRUE</span>, <span class="at">limit=</span><span class="dv">100000</span>)<span class="sc">$</span>data</span></code></pre></div>
<p>We now check the downloaded data and select the fields of interest</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="presence-absence-data.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check names for GBIF data</span></span>
<span id="cb6-2"><a href="presence-absence-data.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mydata.gbif)</span>
<span id="cb6-3"><a href="presence-absence-data.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-4"><a href="presence-absence-data.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#select columns of interest</span></span>
<span id="cb6-5"><a href="presence-absence-data.html#cb6-5" aria-hidden="true" tabindex="-1"></a>mydata.gbif <span class="ot">&lt;-</span> mydata.gbif <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="presence-absence-data.html#cb6-6" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;acceptedScientificName&quot;</span>,</span>
<span id="cb6-7"><a href="presence-absence-data.html#cb6-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;decimalLongitude&quot;</span>,</span>
<span id="cb6-8"><a href="presence-absence-data.html#cb6-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;decimalLatitude&quot;</span>,</span>
<span id="cb6-9"><a href="presence-absence-data.html#cb6-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;year&quot;</span>,</span>
<span id="cb6-10"><a href="presence-absence-data.html#cb6-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;month&quot;</span>,</span>
<span id="cb6-11"><a href="presence-absence-data.html#cb6-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;day&quot;</span>,</span>
<span id="cb6-12"><a href="presence-absence-data.html#cb6-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;eventDate&quot;</span>,</span>
<span id="cb6-13"><a href="presence-absence-data.html#cb6-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;depth&quot;</span>)</span>
<span id="cb6-14"><a href="presence-absence-data.html#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="presence-absence-data.html#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#check names in for OBIS data</span></span>
<span id="cb6-16"><a href="presence-absence-data.html#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mydata.obis)</span>
<span id="cb6-17"><a href="presence-absence-data.html#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="presence-absence-data.html#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#select columns of interest</span></span>
<span id="cb6-19"><a href="presence-absence-data.html#cb6-19" aria-hidden="true" tabindex="-1"></a>mydata.obis <span class="ot">&lt;-</span>  mydata.obis <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="presence-absence-data.html#cb6-20" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;scientificName&quot;</span>,</span>
<span id="cb6-21"><a href="presence-absence-data.html#cb6-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;decimalLongitude&quot;</span>,</span>
<span id="cb6-22"><a href="presence-absence-data.html#cb6-22" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;decimalLatitude&quot;</span>,</span>
<span id="cb6-23"><a href="presence-absence-data.html#cb6-23" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;date_year&quot;</span>,</span>
<span id="cb6-24"><a href="presence-absence-data.html#cb6-24" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;month&quot;</span>,</span>
<span id="cb6-25"><a href="presence-absence-data.html#cb6-25" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;day&quot;</span>,</span>
<span id="cb6-26"><a href="presence-absence-data.html#cb6-26" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;eventDate&quot;</span>,</span>
<span id="cb6-27"><a href="presence-absence-data.html#cb6-27" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;depth&quot;</span>,</span>
<span id="cb6-28"><a href="presence-absence-data.html#cb6-28" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;bathymetry&quot;</span>,</span>
<span id="cb6-29"><a href="presence-absence-data.html#cb6-29" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;occurrenceStatus&quot;</span>,</span>
<span id="cb6-30"><a href="presence-absence-data.html#cb6-30" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;sst&quot;</span>)</span></code></pre></div>
<p>Reformat the data addin a new field and renaming some columns from mydata.gbif dataframe in order to have the same columns and be able to join both tables</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="presence-absence-data.html#cb7-1" aria-hidden="true" tabindex="-1"></a>mydata.gbif <span class="ot">&lt;-</span> mydata.gbif <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="presence-absence-data.html#cb7-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">scientificName=</span> <span class="st">&quot;acceptedScientificName&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="presence-absence-data.html#cb7-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">date_year =</span> <span class="st">&quot;year&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="presence-absence-data.html#cb7-4" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">bathymetry=</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="presence-absence-data.html#cb7-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">occurrenceStatus=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="presence-absence-data.html#cb7-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sst=</span> <span class="cn">NA</span>)</span>
<span id="cb7-7"><a href="presence-absence-data.html#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="presence-absence-data.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Join data from OBIS and GBIF </span></span>
<span id="cb7-9"><a href="presence-absence-data.html#cb7-9" aria-hidden="true" tabindex="-1"></a>mydata.fus<span class="ot">&lt;-</span><span class="fu">rbind</span>(mydata.obis,mydata.gbif)</span>
<span id="cb7-10"><a href="presence-absence-data.html#cb7-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-11"><a href="presence-absence-data.html#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#assign unique scientific name </span></span>
<span id="cb7-12"><a href="presence-absence-data.html#cb7-12" aria-hidden="true" tabindex="-1"></a>  mydata.fus <span class="ot">&lt;-</span> mydata.fus <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="presence-absence-data.html#cb7-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">scientificName=</span> <span class="fu">paste</span>(mydata.obis<span class="sc">$</span>scientificName[<span class="dv">1</span>]))</span></code></pre></div>
<p>Clean raw data</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="presence-absence-data.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#give date format to eventDate and fill out month and date_year columns</span></span>
<span id="cb8-2"><a href="presence-absence-data.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  mydata.fus<span class="sc">$</span>eventDate <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(mydata.fus<span class="sc">$</span>eventDate)</span>
<span id="cb8-3"><a href="presence-absence-data.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  mydata.fus<span class="sc">$</span>date_year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(mydata.fus<span class="sc">$</span>date_year)</span>
<span id="cb8-4"><a href="presence-absence-data.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  mydata.fus<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(mydata.fus<span class="sc">$</span>month)</span>
<span id="cb8-5"><a href="presence-absence-data.html#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="presence-absence-data.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#mutate occurrenceStatus column giving value of 1 to presences and 0 to absences</span></span>
<span id="cb8-7"><a href="presence-absence-data.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="presence-absence-data.html#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span> (mydata.fus<span class="sc">$</span>occurrenceStatus)</span>
<span id="cb8-9"><a href="presence-absence-data.html#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="presence-absence-data.html#cb8-10" aria-hidden="true" tabindex="-1"></a>mydata.fus <span class="ot">&lt;-</span> mydata.fus <span class="sc">%&gt;%</span> </span>
<span id="cb8-11"><a href="presence-absence-data.html#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">occurrenceStatus =</span> <span class="fu">ifelse</span>(occurrenceStatus<span class="sc">==</span> <span class="st">&quot;NA&quot;</span>, <span class="cn">NA</span>, occurrenceStatus)) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="presence-absence-data.html#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">occurrenceStatus =</span> <span class="fu">ifelse</span>(occurrenceStatus<span class="sc">==</span> <span class="st">&quot;Present&quot;</span>, <span class="dv">1</span>, occurrenceStatus)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-13"><a href="presence-absence-data.html#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">occurrenceStatus =</span> <span class="fu">ifelse</span>(occurrenceStatus<span class="sc">==</span> <span class="st">&quot;present&quot;</span>, <span class="dv">1</span>, occurrenceStatus)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="presence-absence-data.html#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">occurrenceStatus =</span> <span class="fu">ifelse</span>(occurrenceStatus<span class="sc">==</span> <span class="st">&quot;Presente&quot;</span>, <span class="dv">1</span>, occurrenceStatus)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-15"><a href="presence-absence-data.html#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">occurrenceStatus =</span> <span class="fu">ifelse</span>(occurrenceStatus<span class="sc">==</span> <span class="st">&quot;Presence&quot;</span>, <span class="dv">1</span>, occurrenceStatus)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-16"><a href="presence-absence-data.html#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">occurrenceStatus =</span> <span class="fu">ifelse</span>(occurrenceStatus<span class="sc">==</span> <span class="st">&quot;P&quot;</span>, <span class="dv">1</span>, occurrenceStatus)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-17"><a href="presence-absence-data.html#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">occurrenceStatus =</span> <span class="fu">ifelse</span>(occurrenceStatus<span class="sc">==</span> <span class="st">&quot;Q&quot;</span>, <span class="dv">1</span>, occurrenceStatus))</span></code></pre></div>
<p>Assign 1 value to all occurrences</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="presence-absence-data.html#cb9-1" aria-hidden="true" tabindex="-1"></a>mydata.fus <span class="ot">&lt;-</span> mydata.fus  <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="presence-absence-data.html#cb9-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">occurrenceStatus =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Remove outliers based on distance method (total distance= 1000 km)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="presence-absence-data.html#cb10-1" aria-hidden="true" tabindex="-1"></a>out.dist <span class="ot">&lt;-</span> <span class="fu">cc_outl</span>(<span class="at">x=</span>mydata.fus,</span>
<span id="cb10-2"><a href="presence-absence-data.html#cb10-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">lon =</span> <span class="st">&quot;decimalLongitude&quot;</span>, <span class="at">lat =</span> <span class="st">&quot;decimalLatitude&quot;</span>,</span>
<span id="cb10-3"><a href="presence-absence-data.html#cb10-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">species =</span> <span class="st">&quot;scientificName&quot;</span>,</span>
<span id="cb10-4"><a href="presence-absence-data.html#cb10-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">method=</span><span class="st">&quot;distance&quot;</span>, <span class="at">tdi=</span><span class="dv">1000</span>, <span class="co"># distance method with tdi=1000km</span></span>
<span id="cb10-5"><a href="presence-absence-data.html#cb10-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">thinning=</span>T, <span class="at">thinning_res=</span><span class="fl">0.5</span>,</span>
<span id="cb10-6"><a href="presence-absence-data.html#cb10-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">value=</span><span class="st">&quot;flagged&quot;</span>) </span>
<span id="cb10-7"><a href="presence-absence-data.html#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="presence-absence-data.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#remove outliers from the data</span></span>
<span id="cb10-9"><a href="presence-absence-data.html#cb10-9" aria-hidden="true" tabindex="-1"></a>mydata.fus <span class="ot">&lt;-</span> mydata.fus[out.dist, ]</span></code></pre></div>
<p>Remove duplicates based on the date</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="presence-absence-data.html#cb11-1" aria-hidden="true" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mydata.fus<span class="sc">$</span>decimalLongitude,mydata.fus<span class="sc">$</span>decimalLatitude,mydata.fus<span class="sc">$</span>eventDate)</span>
<span id="cb11-2"><a href="presence-absence-data.html#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="presence-absence-data.html#cb11-3" aria-hidden="true" tabindex="-1"></a>mydata.fus<span class="ot">&lt;-</span>mydata.fus[<span class="sc">!</span><span class="fu">duplicated</span>(date),]</span></code></pre></div>
<p>Prepare the data to</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="presence-absence-data.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PREPARE DATA TO USE FAO ATLANTIC REGION MASK</span></span>
<span id="cb12-2"><a href="presence-absence-data.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="sc">---------------------------------</span>    </span>
<span id="cb12-3"><a href="presence-absence-data.html#cb12-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-4"><a href="presence-absence-data.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare coordinate format and projection to be able to use FAO zone masks</span></span>
<span id="cb12-5"><a href="presence-absence-data.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(mydata.fus<span class="sc">$</span>decimalLongitude,mydata.fus<span class="sc">$</span>decimalLatitude))</span>
<span id="cb12-6"><a href="presence-absence-data.html#cb12-6" aria-hidden="true" tabindex="-1"></a>  ptos<span class="ot">&lt;-</span><span class="fu">as.data.table</span>(dat,<span class="at">keep.columnnames=</span><span class="cn">TRUE</span>)</span>
<span id="cb12-7"><a href="presence-absence-data.html#cb12-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-8"><a href="presence-absence-data.html#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coordinates</span>(ptos) <span class="ot">&lt;-</span> <span class="er">~</span> X1 <span class="sc">+</span> X2</span>
<span id="cb12-9"><a href="presence-absence-data.html#cb12-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-10"><a href="presence-absence-data.html#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proj4string</span>(ptos) <span class="ot">&lt;-</span><span class="fu">proj4string</span>(study_area)</span>
<span id="cb12-11"><a href="presence-absence-data.html#cb12-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-12"><a href="presence-absence-data.html#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Select only occurrences from FAO Atlantic</span></span>
<span id="cb12-13"><a href="presence-absence-data.html#cb12-13" aria-hidden="true" tabindex="-1"></a>  match2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">subset</span>(mydata.fus,<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">over</span>(ptos, study_area)[,<span class="dv">1</span>])))</span>
<span id="cb12-14"><a href="presence-absence-data.html#cb12-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-15"><a href="presence-absence-data.html#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Extract the FAO area of each point</span></span>
<span id="cb12-16"><a href="presence-absence-data.html#cb12-16" aria-hidden="true" tabindex="-1"></a>  match3<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">subset</span>(<span class="fu">over</span>(ptos, study_area), <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">over</span>(ptos, study_area)[,<span class="dv">1</span>])))</span>
<span id="cb12-17"><a href="presence-absence-data.html#cb12-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-18"><a href="presence-absence-data.html#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create data frame with area, name, lon, lat and year </span></span>
<span id="cb12-19"><a href="presence-absence-data.html#cb12-19" aria-hidden="true" tabindex="-1"></a>  df0<span class="ot">&lt;-</span><span class="fu">cbind</span>(<span class="at">F_AREA=</span>match3<span class="sc">$</span>F_AREA,match2)[,<span class="fu">c</span>(<span class="st">&quot;F_AREA&quot;</span>,<span class="st">&quot;scientificName&quot;</span>,<span class="st">&quot;decimalLongitude&quot;</span>,<span class="st">&quot;decimalLatitude&quot;</span>,<span class="st">&quot;date_year&quot;</span>,<span class="st">&quot;occurrenceStatus&quot;</span>)]</span>
<span id="cb12-20"><a href="presence-absence-data.html#cb12-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-21"><a href="presence-absence-data.html#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rename some columns</span></span>
<span id="cb12-22"><a href="presence-absence-data.html#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(df0)[<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;LON&quot;</span>,<span class="st">&quot;LAT&quot;</span>,<span class="st">&quot;YEAR&quot;</span>)</span>
<span id="cb12-23"><a href="presence-absence-data.html#cb12-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-24"><a href="presence-absence-data.html#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add bathymetry from NOAA</span></span>
<span id="cb12-25"><a href="presence-absence-data.html#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(marmap)</span>
<span id="cb12-26"><a href="presence-absence-data.html#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="presence-absence-data.html#cb12-27" aria-hidden="true" tabindex="-1"></a>  bathy <span class="ot">&lt;-</span> <span class="fu">getNOAA.bathy</span>(<span class="at">lon1=</span><span class="sc">-</span><span class="dv">100</span>,<span class="at">lon2=</span><span class="dv">30</span>,<span class="at">lat1=</span><span class="sc">-</span><span class="dv">41</span>,<span class="at">lat2=</span><span class="dv">55</span>, <span class="at">resolution =</span> <span class="dv">1</span>, </span>
<span id="cb12-28"><a href="presence-absence-data.html#cb12-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">keep=</span><span class="cn">FALSE</span>, <span class="at">antimeridian=</span><span class="cn">FALSE</span>)</span>
<span id="cb12-29"><a href="presence-absence-data.html#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="presence-absence-data.html#cb12-30" aria-hidden="true" tabindex="-1"></a>  df0<span class="sc">$</span>bathymetry <span class="ot">&lt;-</span> <span class="fu">get.depth</span>(bathy, df0[,<span class="fu">c</span>(<span class="st">&quot;LON&quot;</span>,<span class="st">&quot;LAT&quot;</span>)], <span class="at">locator=</span>F)<span class="sc">$</span>depth</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="presence-absence-data.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SAVE OCCURRENCE DATA</span></span>
<span id="cb13-2"><a href="presence-absence-data.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="sc">---------------------------------</span>    </span>
<span id="cb13-3"><a href="presence-absence-data.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="presence-absence-data.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#NOTA INTERNA: quiero guardar el RData en la carpeta data/occurrences con el nombre de la especies sin espacios para no machar los RData en caso de que hagamos más de una especie pero no lo consigo. </span></span>
<span id="cb13-5"><a href="presence-absence-data.html#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="presence-absence-data.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># lo dejo como esta, asi luego al cargar los datos no hay que poner el nombre de la especie y es mas sencillo</span></span>
<span id="cb13-7"><a href="presence-absence-data.html#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="presence-absence-data.html#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(df0, <span class="at">file =</span> <span class="st">&quot;data/occurrences/occ.RData&quot;</span>)</span>
<span id="cb13-9"><a href="presence-absence-data.html#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(study_area, <span class="at">file =</span> <span class="st">&quot;data/spatial/total_area.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="presence-absence-data.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PLOT OCCURRENCES MAP</span></span>
<span id="cb14-2"><a href="presence-absence-data.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="sc">---------------------------------</span>   </span>
<span id="cb14-3"><a href="presence-absence-data.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-4"><a href="presence-absence-data.html#cb14-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_path</span>(<span class="at">data =</span> study_area, </span>
<span id="cb14-5"><a href="presence-absence-data.html#cb14-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb14-6"><a href="presence-absence-data.html#cb14-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&#39;gray&#39;</span>, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="presence-absence-data.html#cb14-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">data=</span>df0, <span class="fu">aes</span>(<span class="at">x=</span>decimalLongitude, <span class="at">y=</span>decimalLatitude,<span class="at">colour=</span> occurrenceStatus)) </span></code></pre></div>
</div>
<div id="create-pseudo-absence-data" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Create pseudo-absence data<a href="presence-absence-data.html#create-pseudo-absence-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After saving presence data for the species of interest we need to generate absence data (with a constant prevalence of 50%, <span class="citation">(<a href="#ref-mcpherson_2004" role="doc-biblioref">McPHERSON, Jetz, and Rogers 2004</a>)</span>,<span class="citation">(<a href="#ref-barbetmassin_etal_2012" role="doc-biblioref">Barbet-Massin et al. 2012</a>)</span>), in order to work with logistic regression SDM afterwards. For that, we generate a buffer around each presence data point, with a radius of 100km, where no absences can be generated.</p>
<p>we load the requiered libraries.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="presence-absence-data.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-2"><a href="presence-absence-data.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-3"><a href="presence-absence-data.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb15-4"><a href="presence-absence-data.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb15-5"><a href="presence-absence-data.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb15-6"><a href="presence-absence-data.html#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="presence-absence-data.html#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)        <span class="co"># some basic country maps</span></span>
<span id="cb15-8"><a href="presence-absence-data.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapdata)     <span class="co"># higher resolution maps</span></span>
<span id="cb15-9"><a href="presence-absence-data.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapproj)</span>
<span id="cb15-10"><a href="presence-absence-data.html#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marmap)      <span class="co"># access global topography data</span></span>
<span id="cb15-11"><a href="presence-absence-data.html#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapplots)    <span class="co"># ices rectangles</span></span>
<span id="cb15-12"><a href="presence-absence-data.html#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb15-13"><a href="presence-absence-data.html#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb15-14"><a href="presence-absence-data.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb15-15"><a href="presence-absence-data.html#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span></code></pre></div>
<p>We load the presence data and the object with the area of study.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="presence-absence-data.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#occurrence data</span></span>
<span id="cb16-2"><a href="presence-absence-data.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/occurrences/occ.RData&quot;</span>)</span>
<span id="cb16-3"><a href="presence-absence-data.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#study area spatial polygon</span></span>
<span id="cb16-4"><a href="presence-absence-data.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/spatial/total_area.RData&quot;</span>)</span></code></pre></div>
<p>Before starting the pseudo-absence generation process, we delete observations in land (positive bathymetry) and select data between 2000 and 2014 (same temporal range as the environmental data that we will load later).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="presence-absence-data.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove points in land</span></span>
<span id="cb17-2"><a href="presence-absence-data.html#cb17-2" aria-hidden="true" tabindex="-1"></a>df0<span class="ot">&lt;-</span><span class="fu">subset</span>(df0,bathymetry<span class="sc">&lt;</span><span class="dv">0</span>)</span>
<span id="cb17-3"><a href="presence-absence-data.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="presence-absence-data.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#use years from 2000 to 2014</span></span>
<span id="cb17-5"><a href="presence-absence-data.html#cb17-5" aria-hidden="true" tabindex="-1"></a>df0<span class="ot">&lt;-</span> <span class="fu">subset</span>(df0, YEAR<span class="sc">&lt;=</span><span class="dv">2014</span> <span class="sc">&amp;</span> YEAR<span class="sc">&gt;=</span><span class="dv">2000</span>)</span>
<span id="cb17-6"><a href="presence-absence-data.html#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="presence-absence-data.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#use the whole saved area</span></span>
<span id="cb17-8"><a href="presence-absence-data.html#cb17-8" aria-hidden="true" tabindex="-1"></a>area <span class="ot">&lt;-</span> study_area</span></code></pre></div>
<p>Then we transform the presence data frame to “SpatialPointsDataFrame” class object and the to “sf” class object so we can operate and plot easily with spatial data. We can see the charaterstics of this object through its summary.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="presence-absence-data.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#convert to spatial point data frame</span></span>
<span id="cb18-2"><a href="presence-absence-data.html#cb18-2" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span>df0 ; <span class="fu">coordinates</span>(df)<span class="ot">&lt;-</span> <span class="er">~</span>LON<span class="sc">+</span>LAT</span>
<span id="cb18-3"><a href="presence-absence-data.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(df)<span class="ot">&lt;-</span><span class="fu">crs</span>(area)</span>
<span id="cb18-4"><a href="presence-absence-data.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="presence-absence-data.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#convert to sf</span></span>
<span id="cb18-6"><a href="presence-absence-data.html#cb18-6" aria-hidden="true" tabindex="-1"></a>area.sf<span class="ot">&lt;-</span><span class="fu">st_union</span>(<span class="fu">st_as_sf</span>(area))</span>
<span id="cb18-7"><a href="presence-absence-data.html#cb18-7" aria-hidden="true" tabindex="-1"></a>df.sf<span class="ot">&lt;-</span><span class="fu">st_as_sf</span>(df)</span>
<span id="cb18-8"><a href="presence-absence-data.html#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="presence-absence-data.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code></pre></div>
<pre><code>## Object of class SpatialPointsDataFrame
## Coordinates:
##        min      max
## LON -95.65 24.45000
## LAT -34.71 54.15014
## Is projected: FALSE 
## proj4string : [+proj=longlat +datum=WGS84 +no_defs]
## Number of points: 15079
## Data attributes:
##     F_AREA          scientificName          YEAR      occurrenceStatus
##  Length:15079       Length:15079       Min.   :2000   Min.   :1       
##  Class :character   Class :character   1st Qu.:2001   1st Qu.:1       
##  Mode  :character   Mode  :character   Median :2002   Median :1       
##                                        Mean   :2003   Mean   :1       
##                                        3rd Qu.:2004   3rd Qu.:1       
##                                        Max.   :2013   Max.   :1       
##    bathymetry      
##  Min.   :-8404.09  
##  1st Qu.:-1904.84  
##  Median :-1023.43  
##  Mean   :-1416.66  
##  3rd Qu.: -293.08  
##  Max.   :   -1.13</code></pre>
<p>We can easily plot sf objects using ggplot, here we plot the area of study and the presence data points</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="presence-absence-data.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(area.sf) <span class="sc">+</span> <span class="fu">geom_sf</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data=</span><span class="fu">st_union</span>(df.sf),<span class="at">size=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>We save a base plot (p0) with the world map and our area of study in blue</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="presence-absence-data.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># basic ggplot</span></span>
<span id="cb21-2"><a href="presence-absence-data.html#cb21-2" aria-hidden="true" tabindex="-1"></a>global <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;worldHires&quot;</span>)</span>
<span id="cb21-3"><a href="presence-absence-data.html#cb21-3" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb21-4"><a href="presence-absence-data.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_map</span>(<span class="at">map=</span>global, <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb21-5"><a href="presence-absence-data.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>area.sf,<span class="at">fill=</span><span class="dv">5</span>)</span>
<span id="cb21-6"><a href="presence-absence-data.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p0)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>In order to generate a buffer around each acurrence data point, we need to work with euclidean distances, so first, we need to transform the decimal latitude and longitude values to UTM.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="presence-absence-data.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to find your UTM. Taken from Nerea Goikoetxea</span></span>
<span id="cb22-2"><a href="presence-absence-data.html#cb22-2" aria-hidden="true" tabindex="-1"></a>lonlat2UTM <span class="ot">=</span> <span class="cf">function</span>(lonlat) {</span>
<span id="cb22-3"><a href="presence-absence-data.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  utm <span class="ot">=</span> (<span class="fu">floor</span>((lonlat[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">180</span>) <span class="sc">/</span> <span class="dv">6</span>) <span class="sc">%%</span> <span class="dv">60</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb22-4"><a href="presence-absence-data.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(lonlat[<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb22-5"><a href="presence-absence-data.html#cb22-5" aria-hidden="true" tabindex="-1"></a>    utm <span class="sc">+</span> <span class="dv">32600</span></span>
<span id="cb22-6"><a href="presence-absence-data.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb22-7"><a href="presence-absence-data.html#cb22-7" aria-hidden="true" tabindex="-1"></a>    utm <span class="sc">+</span> <span class="dv">32700</span></span>
<span id="cb22-8"><a href="presence-absence-data.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-9"><a href="presence-absence-data.html#cb22-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-10"><a href="presence-absence-data.html#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="presence-absence-data.html#cb22-11" aria-hidden="true" tabindex="-1"></a>(EPSG_2_UTM <span class="ot">&lt;-</span> <span class="fu">lonlat2UTM</span>(<span class="fu">c</span>(<span class="fu">mean</span>(df<span class="sc">$</span>LON), <span class="fu">mean</span>(df<span class="sc">$</span>LAT))))</span></code></pre></div>
<pre><code>## [1] 32623</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="presence-absence-data.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform area and data points to UTMs (in m)</span></span>
<span id="cb24-2"><a href="presence-absence-data.html#cb24-2" aria-hidden="true" tabindex="-1"></a>aux <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(area.sf, EPSG_2_UTM)</span>
<span id="cb24-3"><a href="presence-absence-data.html#cb24-3" aria-hidden="true" tabindex="-1"></a>df.sf.utm <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(df.sf, EPSG_2_UTM)</span></code></pre></div>
<p>Now, we can create buffers of 100km around the points and join the resulting polygons. Then this buffer is intersected with the area of study defining the area where the pseudo-absences can be generated. To visualize the defined areas, we plot the buffers in red and the area that we will use to generate pseudo-absences in green.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="presence-absence-data.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create buffers of 100000m</span></span>
<span id="cb25-2"><a href="presence-absence-data.html#cb25-2" aria-hidden="true" tabindex="-1"></a>buffer <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(df.sf.utm, <span class="at">dist=</span><span class="dv">100000</span>)</span>
<span id="cb25-3"><a href="presence-absence-data.html#cb25-3" aria-hidden="true" tabindex="-1"></a>buffer <span class="ot">&lt;-</span> <span class="fu">st_union</span>(buffer)</span>
<span id="cb25-4"><a href="presence-absence-data.html#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="presence-absence-data.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># intersect the are with the buffer</span></span>
<span id="cb25-6"><a href="presence-absence-data.html#cb25-6" aria-hidden="true" tabindex="-1"></a>aux0 <span class="ot">&lt;-</span> <span class="fu">st_difference</span>(aux, buffer)</span>
<span id="cb25-7"><a href="presence-absence-data.html#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="presence-absence-data.html#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot for all data</span></span>
<span id="cb25-9"><a href="presence-absence-data.html#cb25-9" aria-hidden="true" tabindex="-1"></a>p0 <span class="sc">+</span><span class="fu">geom_sf</span>(<span class="at">data=</span>aux0,<span class="at">fill=</span><span class="dv">3</span>)<span class="sc">+</span><span class="fu">geom_sf</span>(<span class="at">data=</span>buffer,<span class="at">fill=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="presence-absence-data.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#zoom</span></span>
<span id="cb26-2"><a href="presence-absence-data.html#cb26-2" aria-hidden="true" tabindex="-1"></a>p0 <span class="sc">+</span><span class="fu">geom_sf</span>(<span class="at">data=</span>aux0,<span class="at">fill=</span><span class="dv">3</span>)<span class="sc">+</span><span class="fu">geom_sf</span>(<span class="at">data=</span>buffer,<span class="at">fill=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb26-3"><a href="presence-absence-data.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">95</span>,<span class="sc">-</span><span class="dv">82</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">22</span>,<span class="dv">31</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-2.png" width="672" /></p>
<p>We create a data frame for pseudo-absences with the same dimensions as the presences data frame.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="presence-absence-data.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the pseudo-absence data frame</span></span>
<span id="cb27-2"><a href="presence-absence-data.html#cb27-2" aria-hidden="true" tabindex="-1"></a>pseudo <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span><span class="fu">dim</span>(df0)[<span class="dv">1</span>], <span class="at">ncol=</span><span class="fu">dim</span>(df0)[<span class="dv">2</span>])</span>
<span id="cb27-3"><a href="presence-absence-data.html#cb27-3" aria-hidden="true" tabindex="-1"></a>pseudo <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pseudo)</span>
<span id="cb27-4"><a href="presence-absence-data.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pseudo) <span class="ot">&lt;-</span> <span class="fu">names</span>(df0)</span></code></pre></div>
<p>To generate the pseudo-absence data points, we sample randomly from the defined area and we extract their latitude and longitude to incorporate them in the created data frame. we set the occurceStatus equal to 0 as they are absences.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="presence-absence-data.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the seed</span></span>
<span id="cb28-2"><a href="presence-absence-data.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-3"><a href="presence-absence-data.html#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="presence-absence-data.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#sample from the defined area</span></span>
<span id="cb28-5"><a href="presence-absence-data.html#cb28-5" aria-hidden="true" tabindex="-1"></a>rp.sf <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(aux0, <span class="at">size=</span><span class="fu">dim</span>(df.sf.utm)[<span class="dv">1</span>], <span class="at">type=</span><span class="st">&quot;random&quot;</span>) <span class="co"># randomly sample points</span></span>
<span id="cb28-6"><a href="presence-absence-data.html#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="presence-absence-data.html#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to lat and lon and extract coordinates as data.frame</span></span>
<span id="cb28-8"><a href="presence-absence-data.html#cb28-8" aria-hidden="true" tabindex="-1"></a>rp.sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(rp.sf, <span class="dv">4326</span>)</span>
<span id="cb28-9"><a href="presence-absence-data.html#cb28-9" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">st_coordinates</span>(rp.sf)) </span>
<span id="cb28-10"><a href="presence-absence-data.html#cb28-10" aria-hidden="true" tabindex="-1"></a>pseudo<span class="sc">$</span>LON <span class="ot">&lt;-</span> rp<span class="sc">$</span>X</span>
<span id="cb28-11"><a href="presence-absence-data.html#cb28-11" aria-hidden="true" tabindex="-1"></a>pseudo<span class="sc">$</span>LAT <span class="ot">&lt;-</span> rp<span class="sc">$</span>Y</span>
<span id="cb28-12"><a href="presence-absence-data.html#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="presence-absence-data.html#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># complete the rest of columns</span></span>
<span id="cb28-14"><a href="presence-absence-data.html#cb28-14" aria-hidden="true" tabindex="-1"></a>pseudo<span class="sc">$</span>scientificName <span class="ot">&lt;-</span> df0<span class="sc">$</span>scientificName</span>
<span id="cb28-15"><a href="presence-absence-data.html#cb28-15" aria-hidden="true" tabindex="-1"></a>pseudo<span class="sc">$</span>occurrenceStatus  <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
<p>We can plot the generated pseudo-absence data (in pink) in the map, together with the presence data points (in black).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="presence-absence-data.html#cb29-1" aria-hidden="true" tabindex="-1"></a>p0 <span class="sc">+</span></span>
<span id="cb29-2"><a href="presence-absence-data.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>rp.sf, <span class="at">col=</span><span class="dv">6</span>, <span class="at">shape=</span><span class="dv">4</span>,<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb29-3"><a href="presence-absence-data.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>df.sf.utm, <span class="at">col=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.8</span>,<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb29-4"><a href="presence-absence-data.html#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">unique</span>(df<span class="sc">$</span>scientificName))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="presence-absence-data.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#zoom</span></span>
<span id="cb30-2"><a href="presence-absence-data.html#cb30-2" aria-hidden="true" tabindex="-1"></a>p0 <span class="sc">+</span></span>
<span id="cb30-3"><a href="presence-absence-data.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>rp.sf, <span class="at">col=</span><span class="dv">6</span>, <span class="at">shape=</span><span class="dv">4</span>,<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb30-4"><a href="presence-absence-data.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>df.sf.utm, <span class="at">col=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.8</span>,<span class="at">size=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb30-5"><a href="presence-absence-data.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">95</span>,<span class="sc">-</span><span class="dv">82</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">23</span>,<span class="dv">31</span>))<span class="sc">+</span></span>
<span id="cb30-6"><a href="presence-absence-data.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">unique</span>(df<span class="sc">$</span>scientificName))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-25-2.png" width="672" /></p>
<p>Finally we join the presence and pseudo-absence data frames selecting the columns of interest and save the new data frame as well as the area object.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="presence-absence-data.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the two data sets and save the final dataset</span></span>
<span id="cb31-2"><a href="presence-absence-data.html#cb31-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df0, pseudo)[,<span class="fu">c</span>(<span class="st">&quot;scientificName&quot;</span>,<span class="st">&quot;LON&quot;</span>,<span class="st">&quot;LAT&quot;</span>,<span class="st">&quot;YEAR&quot;</span>,<span class="st">&quot;occurrenceStatus&quot;</span>)]</span>
<span id="cb31-3"><a href="presence-absence-data.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(<span class="at">list=</span><span class="fu">c</span>(<span class="st">&quot;dat&quot;</span>),<span class="at">file=</span><span class="fu">file.path</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;outputs_for_modelling&quot;</span>,<span class="at">file=</span><span class="st">&quot;PAdata.RData&quot;</span>))</span>
<span id="cb31-4"><a href="presence-absence-data.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(<span class="at">list=</span><span class="fu">c</span>(<span class="st">&quot;area&quot;</span>),<span class="at">file=</span><span class="fu">file.path</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;spatial&quot;</span>,<span class="at">file=</span><span class="st">&quot;area.RData&quot;</span>))</span></code></pre></div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-barbetmassin_etal_2012" class="csl-entry">
Barbet-Massin, Morgane, Frédéric Jiguet, Cécile Hélène Albert, and Wilfried Thuiller. 2012. <span>“Selecting Pseudo-Absences for Species Distribution Models: How, Where and How Many?”</span> Journal Article. <em>Methods in Ecology and Evolution</em> 3 (2): 327–38. <a href="https://doi.org/10.1111/j.2041-210X.2011.00172.x">https://doi.org/10.1111/j.2041-210X.2011.00172.x</a>.
</div>
<div id="ref-mcpherson_2004" class="csl-entry">
McPHERSON, JANA M, Walter Jetz, and David J Rogers. 2004. <span>“The Effects of Species’ Range Sizes on the Accuracy of Distribution Models: Ecological Phenomenon or Statistical Artefact?”</span> <em>Journal of Applied Ecology</em> 41 (5): 811–23.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="environmental-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Fundacion-AZTI/SDM/edit/master/02-data_pa.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
